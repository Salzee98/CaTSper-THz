# CaTx (Cambridge Terahertz Converter) Tutorial

## Introduction
This page gives detailed guidance to use [CaTx (Cambridge Terahertz Converter)](https://github.com/dotTHzTAG/CaTx). The input will be the raw data generated by the terahertz spectrometer software ([click here for sample data files](https://github.com/dotTHzTAG/CaTx/tree/main/Example%20Data)).

This tool provides a platform to collate the raw sample and reference waveform(s) into a single standardised [.thz file](/thz_file_format.md). Other metadata captured from different sources can also be included in this file format, including, but not limited to, sample thickness, temperature and other contextual information. The output '.thz' file will be an essential input for the CaTSper analysis tool.

When the user launches the CaTx tool, the following UI will display:

![catx main GUI](/images/catx_gui.png)

## Loading the Raw Dataset
CaTSper will read the '.thz' file created by CaTx. The first step is to convert the data structure generated by the terahertz instrument into the '.thz' file format. In this example, a Terapulse 4000 (Teraview) spectrometer recorded the data in the '.tprj' document.

<b>Step 1</b>: Click the 'Import Measurement' button to browse the folder and select the raw data file for conversion. The selected document’s name will appear in the textbox with the suffix ('.tprj' here). The user needs to choose the correct 'Converter Engine' that can recognise the dataset. As an example, for the Terapulse 4000 (Teraview) spectrometer in transmission mode, 'TeraPulse4000_TX_UCAM' should be selected.

NOTICE: If there is no relevant '.m' engine document in the '.\engine' folder under the same directory as the converter app, a message will display in the dropdown box: '<b>No engines available. Please check m files in .\engine folder.</b>'. The user can [download the engines from here](https://github.com/dotTHzTAG/CaTx/tree/main/Engines).

<b>Step 2</b>: Click the 'Deploy Data' button and the app will read the raw data. A message 'Loading…' followed by the '…%' will appear at the bottom left corner showing the extent of conversion.

<b>Step 3</b>: When the conversion finishes, the message 'Conversion Complete' will appear and the data will be recorded in the table shown in the centre panel. The user can check if the data have been correctly converted in this panel. The following screenshot presents what the user should expect at this stage:

### Terapulse 4000
The user will find the following UI if the document '1_VariableTemperature_original.tprj' generated by the Terapulse 4000 spectrometer is successfully loaded:
![tp4000 successful deploy](/images/THz_converter/catx_terapulse_loaded.png)
This is an example of loading only a single document.

### MenloSystems
The user will find the following UI if the documents '20221025_163815_averageOver_1200_Air_Purged.dat', '20221025_160842_averageOver_1200_Silicon_Purged.dat' and '20221025_170045_averageOver_1200_MetasurfaceAR_3-4_Purged.dat' generated by the MenloSystems spectrometer are successfully loaded:
![menlosystems successful deploy](/images/THz_converter/catx_menlo_loaded_multi.png)
This is an example of loading <b>multiple documents</b> to CaTx. CaTx can read multiple documents if the user has already selected one document and clicked 'Import Measurement' again to choose another document. This process can be done either before or after clicking 'Deploy Data'.

### Toptica
The user will find the following UI if the documents 'Gua_5percent_105K.csv' and 'test_mirror_reflection.csv' generated by the Terapulse 4000 spectrometer are successfully loaded:
![toptica successful deploy](/images/THz_converter/catx_toptica_loaded.png)
This is also an example of loading <b>multiple documents</b> to CaTx.

## Saving the '.thz' File
If the user wants to keep the data, simply press the 'Export .thz File' button to the bottom right corner and choose the folder path where the '.thz' file will be stored.

## Converting Another Dataset
Press the 'Clear Memory' button in the first instance and confirm this action in the message shown. Then follow the procedure in the 'Loading the Raw Dataset' section above to load another raw data file into the converter.

## Editing the 'Instrument Profile' and 'User Profile' rows
The instrument used and user operating said instrument can be stored alongside the measurements in the 'Instrument Profile' and 'User Profile' rows, which are edited in the 'Instruments and Users' tab.

[insert screenshot of 'Instruments and Users' tab]

For both the 'Instrument' and 'User' sections, the user can click 'Add Profile' to insert a new column, then double-click on each cell in the new profile to customise it. Once the relevant profile exists, click on any cell in the column an the 'Selection' box below should update. Insert the column numbers for which the profile should be assigned, then click 'Link' to update this in the 'Measurements and Metadata' tab. Instead of clicking 'Link', the user can click 'Anonymous Instrument Profile, 0' or 'Anonymous User Profile, 0' to assign blank, anonymous profiles.

## Editing the metadata
![catsperMATconverter edit data](/images/THz_converter/Thickness_Edit.png)
The terahertz instrument might not record, for example, the thickness of the sample (mm), sample weight (mg) and temperature (K) at which the measurements were undertaken. The converter allows user to input any additional information that may be relevant to the measurements. Any cell in the 'Metadata Description' row (row #9) can be edited by double-clicking the cell and inputting a list of metadata labels separated by commas e.g. 'Mass RBV (mg), Mass PE (mg), Thickness (mm), Reference thickness (mm)'. These labels will be assigned to the rows below, and up to seven different metadata types can be inputted (rows #10-16). The numerical data in the bulk of the table can be edited by double-clicking on the relevant cell.

## Loading the Converted Dataset (.thz File)
The 'Import .thz File' button enables the user to load an already converted file into the converter, for example, add extra data by following the procedure outlined in the 'Editing Thickness and Temperature Information' section above.
